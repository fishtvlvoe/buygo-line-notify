# Phase 13 Plan 02: 解除綁定功能實作

## 目標

實作解除 LINE 綁定的後端 API 和前端 AJAX 處理

## 功能需求

**FRONTEND-05**: 解除綁定功能
- AJAX endpoint: `admin-ajax.php?action=buygo_line_unbind`
- 安全驗證：nonce
- 功能：刪除 LINE 綁定記錄、清除相關 user_meta
- 回應：JSON（success/error）

## 實作步驟

### Task 1: 擴展 LineUserService

新增方法：
- `unlinkUserByUserId($user_id)` - 解除綁定（軟刪除或硬刪除）

### Task 2: 建立 AJAX Handler

在 `SettingsPage` 或新建 `UnbindHandler`:
- 註冊 AJAX action: `wp_ajax_buygo_line_unbind`
- 驗證 nonce
- 檢查權限（只能解除自己的綁定，除非是管理員）
- 呼叫 `LineUserService::unlinkUserByUserId()`
- 清除相關 user_meta（avatar、display_name）
- 返回 JSON 回應

### Task 3: 前端已完成

在 Plan 13-01 的 `AccountIntegrationService` 中已實作 JavaScript

## 安全考量

1. **Nonce 驗證**: 防 CSRF
2. **權限檢查**:
   - 一般用戶只能解除自己的綁定
   - 管理員可解除任何用戶的綁定
3. **日誌記錄**: 記錄解除綁定操作

## 驗證標準

- [ ] 點擊「解除綁定」顯示確認對話框
- [ ] 確認後發送 AJAX 請求
- [ ] 成功後重新載入頁面，顯示未綁定狀態
- [ ] 失敗時顯示錯誤訊息
- [ ] 日誌記錄解除綁定操作

## 檔案清單

**修改**:
- `includes/services/class-line-user-service.php` - 新增 unlinkUserByUserId
- `includes/admin/class-settings-page.php` - 新增 AJAX handler
